@model workwise.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 text-dark fw-normal mb-1">Welcome back, @ViewBag.UserName</h1>
        <p class="text-muted small mb-0">Here's your productivity overview for @DateTime.Now.ToString("MMMM dd, yyyy")</p>
    </div>
    <a asp-controller="Tasks" asp-action="Create" class="btn btn-dark">
        Add Task
    </a>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="card border-0 bg-light h-100">
            <div class="card-body p-4 text-center">
                <div class="h2 text-dark mb-1">@Model.TotalTasks</div>
                <div class="text-muted small">Total Tasks</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card border-0 bg-light h-100">
            <div class="card-body p-4 text-center">
                <div class="h2 text-success mb-1">@Model.CompletedTasks</div>
                <div class="text-muted small">Completed</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card border-0 bg-light h-100">
            <div class="card-body p-4 text-center">
                <div class="h2 text-warning mb-1">@Model.PendingTasks</div>
                <div class="text-muted small">In Progress</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card border-0 bg-light h-100">
            <div class="card-body p-4 text-center">
                <div class="h2 text-danger mb-1">@Model.OverdueTasks</div>
                <div class="text-muted small">Overdue</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Today's Tasks -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center py-3">
                <h5 class="text-dark mb-0">Today's Tasks</h5>
                <span class="badge bg-light text-dark border">@DateTime.Now.ToString("MMM dd")</span>
            </div>
            <div class="card-body p-0">
                @if (Model.TodaysTasks?.Any() == true)
                {
                    <div class="list-group list-group-flush">
                        @foreach (var task in Model.TodaysTasks.Take(5))
                        {
                            var isOverdue = task.DueDate.HasValue && task.DueDate < DateTime.Now && !task.IsCompleted;
                            var itemClass = task.IsCompleted ? "text-muted" : (isOverdue ? "border-start border-danger border-3" : "");
                            
                            <div class="list-group-item border-0 py-3 @itemClass">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        @if (task.IsCompleted)
                                        {
                                            <span class="text-success">‚úì</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">‚óã</span>
                                        }
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="fw-medium text-dark @(task.IsCompleted ? "text-decoration-line-through" : "")" style="cursor: pointer;" 
                                     onclick="location.href='@Url.Action("Details", "Tasks", new { id = task.Id })'">
                                            @task.Title
                                        </div>
                                        @if (task.Category != null)
                                        {
                                            <div class="d-flex align-items-center mt-1">
                                                <div class="rounded-circle me-2" 
                                                     style="width: 8px; height: 8px; background-color: @task.Category.Color;"></div>
                                                <small class="text-muted">@task.Category.Name</small>
                                            </div>
                                        }
                                    </div>
                                    <div class="text-end">
                                        @switch (task.Priority)
                                        {
                                            case Priority.High:
                                                <span class="badge bg-danger">High</span>
                                                break;
                                            case Priority.Medium:
                                                <span class="badge bg-warning text-dark">Medium</span>
                                                break;
                                            case Priority.Low:
                                                <span class="badge bg-secondary">Low</span>
                                                break;
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    
                    @if (Model.TodaysTasks.Count > 5)
                    {
                        <div class="card-footer bg-light text-center py-3">
                            <a asp-controller="Tasks" asp-action="Index" class="btn btn-outline-secondary btn-sm">
                                View All @Model.TodaysTasks.Count Tasks
                            </a>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <div class="mb-3">
                            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 60px; height: 60px;">
                                <span class="text-muted h4 mb-0">üìã</span>
                            </div>
                        </div>
                        <h6 class="text-dark mb-2">No tasks for today</h6>
                        <p class="text-muted small mb-3">Start by creating your first task</p>
                        <a asp-controller="Tasks" asp-action="Create" class="btn btn-outline-dark">
                            Create Task
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <!-- Quick Actions & Recent Categories -->
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="text-dark mb-0">Quick Actions</h5>
            </div>
            <div class="card-body p-3">
                <div class="d-grid gap-2">
                    <a asp-controller="Tasks" asp-action="Create" class="btn btn-outline-dark">
                        Add Task
                    </a>
                    <a asp-controller="Categories" asp-action="Create" class="btn btn-outline-secondary">
                        Create Category
                    </a>
                    <a asp-controller="Tasks" asp-action="Index" class="btn btn-outline-secondary">
                        View All Tasks
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Categories -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="text-dark mb-0">Categories</h5>
            </div>
            <div class="card-body p-3">
                @if (Model.RecentCategories?.Any() == true)
                {
                    <div class="list-group list-group-flush">
                        @foreach (var category in Model.RecentCategories.Take(4))
                        {
                            <div class="list-group-item border-0 px-0 py-2">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle me-3" 
                                         style="width: 12px; height: 12px; background-color: @category.Color;"></div>
                                    <div class="flex-grow-1">
                                        <div class="fw-medium text-dark">@category.Name</div>
                                        <small class="text-muted">@(category.Tasks?.Count ?? 0) tasks</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    
                    <div class="text-center mt-3">
                        <a asp-controller="Categories" asp-action="Index" class="btn btn-outline-secondary btn-sm">
                            View All Categories
                        </a>
                    </div>
                }
                else
                {
                    <div class="text-center py-3">
                        <div class="mb-2">
                            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 40px; height: 40px;">
                                <span class="text-muted">üìÅ</span>
                            </div>
                        </div>
                        <p class="text-muted small mb-2">No categories yet</p>
                        <a asp-controller="Categories" asp-action="Create" class="btn btn-outline-secondary btn-sm">
                            Create First Category
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Progress Overview (if there are tasks) -->
@if (Model.TotalTasks > 0)
{
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-dark mb-0">Overall Progress</h5>
                        <span class="text-muted">@Model.CompletionPercentage.ToString("F1")% Complete</span>
                    </div>
                    <div class="progress bg-light" style="height: 8px;">
                        <div class="progress-bar bg-dark" 
                             role="progressbar" 
                             style="width: @Model.CompletionPercentage%" 
                             aria-valuenow="@Model.CompletionPercentage" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        // Dashboard interactivity
        $(document).ready(function() {
            // Add subtle hover effects to cards
            $('.card').hover(
                function() { 
                    $(this).removeClass('shadow-sm').addClass('shadow'); 
                },
                function() { 
                    $(this).removeClass('shadow').addClass('shadow-sm'); 
                }
            );
        });
    </script>
}